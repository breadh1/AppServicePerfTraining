<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Leak Training Lab - Operation Manual</title>
    <style>
        :root {
            --primary: #0078d4;
            --primary-dark: #106ebe;
            --primary-light: #deecf9;
            --success: #107c10;
            --success-light: #dff6dd;
            --warning: #ff8c00;
            --warning-light: #fff4ce;
            --danger: #d13438;
            --danger-light: #fde7e9;
            --bg-light: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #323130;
            --text-secondary: #605e5c;
            --border: #e1dfdd;
            --shadow: rgba(0, 0, 0, 0.08);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #ffffff 0%, #f0f4f8 100%);
            color: var(--text-primary);
            padding: 40px 20px;
            text-align: center;
            border-radius: 0 0 20px 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px var(--shadow);
            border-bottom: 4px solid var(--primary);
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #0078d4, #50a3d9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        header p {
            font-size: 1.2em;
            color: var(--text-secondary);
        }
        
        .badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 5px;
        }
        
        .badge-primary { background: var(--primary-light); color: var(--primary); border: 1px solid var(--primary); }
        .badge-success { background: var(--success-light); color: var(--success); border: 1px solid var(--success); }
        .badge-warning { background: var(--warning-light); color: #986000; border: 1px solid var(--warning); }
        .badge-danger { background: var(--danger-light); color: var(--danger); border: 1px solid var(--danger); }
        
        .card {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 2px 12px var(--shadow);
            border: 1px solid var(--border);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card h3 {
            color: var(--text-primary);
            margin: 20px 0 15px;
        }
        
        .toc {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            border-left: 4px solid var(--primary);
        }
        
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        
        .toc li {
            padding: 8px 0;
        }
        
        .toc a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .toc a:hover {
            color: var(--primary-dark);
            padding-left: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        th {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f5f5f5;
        }
        
        code {
            background: #f4f4f4;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Cascadia Code', 'Consolas', monospace;
            font-size: 0.9em;
            color: var(--danger);
        }
        
        pre {
            background: #f6f8fa;
            color: #24292e;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 15px 0;
            border: 1px solid var(--border);
        }
        
        pre code {
            background: none;
            color: inherit;
            padding: 0;
        }
        
        .highlight-green { color: #22863a; }
        .highlight-blue { color: #005cc5; }
        .highlight-yellow { color: #6f42c1; }
        .highlight-orange { color: #d73a49; }
        
        .step {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-content h4 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .warning-box {
            background: #fff4ce;
            border-left: 4px solid var(--warning);
            padding: 15px 20px;
            border-radius: 0 10px 10px 0;
            margin: 15px 0;
        }
        
        .warning-box::before {
            content: "‚ö†Ô∏è ";
        }
        
        .info-box {
            background: #e6f3ff;
            border-left: 4px solid var(--primary);
            padding: 15px 20px;
            border-radius: 0 10px 10px 0;
            margin: 15px 0;
        }
        
        .info-box::before {
            content: "üí° ";
        }
        
        .success-box {
            background: #dff6dd;
            border-left: 4px solid var(--success);
            padding: 15px 20px;
            border-radius: 0 10px 10px 0;
            margin: 15px 0;
        }
        
        .success-box::before {
            content: "‚úÖ ";
        }
        
        .button-demo {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            margin: 5px;
            border: none;
            cursor: pointer;
        }
        
        .btn-start { background: linear-gradient(135deg, #ff9a9e, #fecfef); color: #c0392b; border: 1px solid #e74c3c; }
        .btn-stop { background: linear-gradient(135deg, #a8edea, #fed6e3); color: #16a085; border: 1px solid #1abc9c; }
        .btn-clear { background: linear-gradient(135deg, #d4fc79, #96e6a1); color: #27ae60; border: 1px solid #2ecc71; }
        .btn-inject { background: linear-gradient(135deg, #fff3b0, #ffeaa7); color: #d68910; border: 1px solid #f39c12; }
        
        .screenshot {
            border: 2px solid var(--border);
            border-radius: 10px;
            margin: 15px 0;
            padding: 20px;
            background: #fafafa;
            text-align: center;
        }
        
        .screenshot-placeholder {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            color: var(--text-secondary);
            padding: 40px;
            border-radius: 10px;
            font-style: italic;
            border: 2px dashed var(--border);
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .exercise-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            border-radius: 10px;
            padding: 20px;
            border-top: 4px solid var(--primary);
        }
        
        .exercise-card h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .exercise-card .difficulty {
            margin-bottom: 15px;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }
        
        .nav-btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .nav-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        footer {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
            margin-top: 30px;
            background: var(--bg-card);
            border-radius: 15px;
            box-shadow: 0 2px 12px var(--shadow);
        }
        
        footer a {
            color: var(--primary);
        }
        
        @media print {
            body {
                background: white;
            }
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üß† Memory Leak Training Lab</h1>
        <p>Operation Manual for Azure App Service Performance Troubleshooting</p>
        <div style="margin-top: 20px;">
            <span class="badge badge-primary">Version 1.0</span>
            <span class="badge badge-success">.NET 9.0</span>
            <span class="badge badge-warning">Azure App Service</span>
        </div>
    </header>

    <div class="container">
        <!-- Table of Contents -->
        <div class="card toc" id="toc">
            <h2>üìë Table of Contents</h2>
            <ul>
                <li><a href="#overview">1. Overview</a></li>
                <li><a href="#architecture">2. Architecture & How It Works</a></li>
                <li><a href="#dashboard">3. Dashboard Guide</a></li>
                <li><a href="#api">4. API Reference</a></li>
                <li><a href="#exercises">5. Training Exercises</a></li>
                <li><a href="#azure-monitoring">6. Azure Monitoring Guide</a></li>
                <li><a href="#memory-dump">7. Memory Dump Analysis</a></li>
                <li><a href="#deployment">8. Deployment Guide</a></li>
                <li><a href="#troubleshooting">9. Troubleshooting</a></li>
                <li><a href="#cleanup">10. Cleanup Resources</a></li>
            </ul>
        </div>

        <!-- Overview -->
        <div class="card" id="overview">
            <h2>üìã 1. Overview</h2>
            <p>The Memory Leak Training Lab is a web application designed to help engineers learn how to diagnose and troubleshoot memory leak issues in Azure App Service. It provides controlled memory leak scenarios that simulate real-world problems.</p>
            
            <h3>Key Features</h3>
            <table>
                <tr>
                    <th>Feature</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><strong>Continuous Leak</strong></td>
                    <td>Generate ~5MB/sec of memory leak automatically (10MB every 2 seconds)</td>
                </tr>
                <tr>
                    <td><strong>One-time Injection</strong></td>
                    <td>Inject 10-200MB of memory instantly with a slider</td>
                </tr>
                <tr>
                    <td><strong>Real-time Monitoring</strong></td>
                    <td>View leaked memory, GC stats, and heap size</td>
                </tr>
                <tr>
                    <td><strong>Memory Cleanup</strong></td>
                    <td>Clear all leaked memory and force garbage collection</td>
                </tr>
            </table>

            <div class="info-box">
                <strong>Training URL:</strong> <a href="https://memoryleak-training.azurewebsites.net" target="_blank">https://memoryleak-training.azurewebsites.net</a>
            </div>
        </div>

        <!-- Architecture -->
        <div class="card" id="architecture">
            <h2>üèóÔ∏è 2. Architecture & How It Works</h2>
            
            <h3>Memory Leak Mechanism</h3>
            <p>The application uses a <code>ConcurrentBag&lt;byte[]&gt;</code> static collection to hold byte arrays. Since these objects are always referenced by the static collection, the Garbage Collector (GC) cannot reclaim them, causing memory to grow continuously.</p>
            
            <pre><code><span class="highlight-green">// Static collection - objects here will NOT be garbage collected</span>
<span class="highlight-blue">var</span> leakedObjects = <span class="highlight-blue">new</span> <span class="highlight-yellow">ConcurrentBag</span>&lt;<span class="highlight-blue">byte</span>[]&gt;();

<span class="highlight-green">// Creating a memory leak</span>
<span class="highlight-blue">var</span> leakyData = <span class="highlight-blue">new byte</span>[5 * 1024 * 1024]; <span class="highlight-green">// 5MB</span>
<span class="highlight-yellow">Random</span>.Shared.<span class="highlight-yellow">NextBytes</span>(leakyData);
leakedObjects.<span class="highlight-yellow">Add</span>(leakyData); <span class="highlight-green">// Added to static - will never be GC'd</span></code></pre>

            <h3>Why This Causes a Memory Leak</h3>
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Object Creation</h4>
                    <p>A large byte array (5MB) is allocated on the Large Object Heap (LOH)</p>
                </div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>Reference Retention</h4>
                    <p>The object is added to a static collection, creating a strong reference</p>
                </div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>GC Cannot Collect</h4>
                    <p>Since the object is still reachable via the static reference, GC considers it "in use"</p>
                </div>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>Memory Grows</h4>
                    <p>Repeating this process causes unbounded memory growth until OutOfMemory</p>
                </div>
            </div>

            <div class="warning-box">
                <strong>Common Real-World Causes:</strong> Event handlers not unsubscribed, static collections growing unbounded, caching without eviction policies, long-lived objects holding references to short-lived ones.
            </div>
        </div>

        <!-- Dashboard Guide -->
        <div class="card" id="dashboard">
            <h2>üñ•Ô∏è 3. Dashboard Guide</h2>
            
            <h3>Status Panel</h3>
            <table>
                <tr>
                    <th>Metric</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><strong>Leaked Memory (MB)</strong></td>
                    <td>Total size of objects held in the static collection</td>
                </tr>
                <tr>
                    <td><strong>Object Count</strong></td>
                    <td>Number of byte arrays in the collection</td>
                </tr>
                <tr>
                    <td><strong>GC Heap (MB)</strong></td>
                    <td>Total managed heap size reported by .NET runtime</td>
                </tr>
                <tr>
                    <td><strong>Leak Status</strong></td>
                    <td>Indicates if continuous leak is active (red pulsing = active)</td>
                </tr>
                <tr>
                    <td><strong>Gen 0/1/2</strong></td>
                    <td>Number of garbage collections per generation</td>
                </tr>
            </table>

            <h3>Control Buttons</h3>
            <div style="margin: 20px 0;">
                <button class="button-demo btn-start">‚ñ∂Ô∏è Start Leak</button>
                <span>Starts continuous memory leak (~5MB/sec)</span>
            </div>
            <div style="margin: 20px 0;">
                <button class="button-demo btn-stop">‚èπÔ∏è Stop Leak</button>
                <span>Stops the continuous leak (leaked memory remains)</span>
            </div>
            <div style="margin: 20px 0;">
                <button class="button-demo btn-clear">üóëÔ∏è Clear Memory</button>
                <span>Clears all leaked memory and forces GC</span>
            </div>
            <div style="margin: 20px 0;">
                <button class="button-demo btn-inject">Inject Memory</button>
                <span>One-time injection of selected MB amount</span>
            </div>

            <div class="info-box">
                The dashboard auto-refreshes every second. Watch the memory bar fill up as you leak memory!
            </div>
        </div>

        <!-- API Reference -->
        <div class="card" id="api">
            <h2>üîå 4. API Reference</h2>
            
            <table>
                <tr>
                    <th>Endpoint</th>
                    <th>Method</th>
                    <th>Description</th>
                    <th>Response</th>
                </tr>
                <tr>
                    <td><code>/</code></td>
                    <td>GET</td>
                    <td>Dashboard UI</td>
                    <td>HTML page</td>
                </tr>
                <tr>
                    <td><code>/start</code></td>
                    <td>GET</td>
                    <td>Start continuous memory leak</td>
                    <td>Text message</td>
                </tr>
                <tr>
                    <td><code>/stop</code></td>
                    <td>GET</td>
                    <td>Stop continuous memory leak</td>
                    <td>Text message with stats</td>
                </tr>
                <tr>
                    <td><code>/status</code></td>
                    <td>GET</td>
                    <td>Get current memory status</td>
                    <td>JSON object</td>
                </tr>
                <tr>
                    <td><code>/clear</code></td>
                    <td>GET</td>
                    <td>Clear leaked memory & force GC</td>
                    <td>Text message with stats</td>
                </tr>
                <tr>
                    <td><code>/leak?mb=50</code></td>
                    <td>GET</td>
                    <td>One-time leak of specified MB</td>
                    <td>Text message with total</td>
                </tr>
            </table>

            <h3>Status Response Example</h3>
            <pre><code>{
  <span class="highlight-orange">"leakedMemoryMB"</span>: 150.00,
  <span class="highlight-orange">"objectCount"</span>: 30,
  <span class="highlight-orange">"isLeaking"</span>: <span class="highlight-blue">true</span>,
  <span class="highlight-orange">"gcHeapSizeMB"</span>: 165.50,
  <span class="highlight-orange">"gen0Collections"</span>: 45,
  <span class="highlight-orange">"gen1Collections"</span>: 12,
  <span class="highlight-orange">"gen2Collections"</span>: 3,
  <span class="highlight-orange">"totalAvailableMemoryMB"</span>: 1750.00
}</code></pre>
        </div>

        <!-- Training Exercises -->
        <div class="card" id="exercises">
            <h2>üéØ 5. Training Exercises</h2>
            
            <div class="grid-2">
                <div class="exercise-card">
                    <h4>Exercise 1: Observe Memory Growth</h4>
                    <div class="difficulty">
                        <span class="badge badge-success">Beginner</span>
                        <span class="badge badge-primary">15 mins</span>
                    </div>
                    <ol>
                        <li>Open the dashboard</li>
                        <li>Open Azure Portal ‚Üí App Service ‚Üí Metrics</li>
                        <li>Add "Memory working set" metric</li>
                        <li>Click "Start Leak" on dashboard</li>
                        <li>Watch memory grow in both places</li>
                        <li>Observe GC collection counts increasing</li>
                    </ol>
                    <div class="success-box">
                        <strong>Goal:</strong> Understand correlation between app metrics and Azure metrics
                    </div>
                </div>

                <div class="exercise-card">
                    <h4>Exercise 2: Capture Memory Dump</h4>
                    <div class="difficulty">
                        <span class="badge badge-warning">Intermediate</span>
                        <span class="badge badge-primary">30 mins</span>
                    </div>
                    <ol>
                        <li>Inject 300-500MB of memory</li>
                        <li>Go to Azure Portal ‚Üí App Service</li>
                        <li>Navigate to "Diagnose and solve problems"</li>
                        <li>Select "Diagnostic Tools" ‚Üí "Collect Memory Dump"</li>
                        <li>Download the dump file</li>
                        <li>Open with Visual Studio or dotnet-dump</li>
                    </ol>
                    <div class="success-box">
                        <strong>Goal:</strong> Learn to collect memory dumps from production
                    </div>
                </div>

                <div class="exercise-card">
                    <h4>Exercise 3: Analyze the Dump</h4>
                    <div class="difficulty">
                        <span class="badge badge-danger">Advanced</span>
                        <span class="badge badge-primary">45 mins</span>
                    </div>
                    <ol>
                        <li>Open dump in Visual Studio</li>
                        <li>Click "Debug Managed Memory"</li>
                        <li>Sort by "Inclusive Size"</li>
                        <li>Find <code>System.Byte[]</code> objects</li>
                        <li>View "Paths to Root"</li>
                        <li>Identify <code>ConcurrentBag</code> as the root cause</li>
                    </ol>
                    <div class="success-box">
                        <strong>Goal:</strong> Master memory dump analysis techniques
                    </div>
                </div>

                <div class="exercise-card">
                    <h4>Exercise 4: Set Up Alerts</h4>
                    <div class="difficulty">
                        <span class="badge badge-warning">Intermediate</span>
                        <span class="badge badge-primary">20 mins</span>
                    </div>
                    <ol>
                        <li>Go to Azure Portal ‚Üí App Service ‚Üí Alerts</li>
                        <li>Create new alert rule</li>
                        <li>Condition: Memory Working Set > 500MB</li>
                        <li>Action: Email notification</li>
                        <li>Trigger the leak and receive alert</li>
                    </ol>
                    <div class="success-box">
                        <strong>Goal:</strong> Learn proactive monitoring with Azure Alerts
                    </div>
                </div>
            </div>
        </div>

        <!-- Azure Monitoring -->
        <div class="card" id="azure-monitoring">
            <h2>üìä 6. Azure Monitoring Guide</h2>
            
            <h3>Key Metrics to Monitor</h3>
            <table>
                <tr>
                    <th>Metric</th>
                    <th>Location</th>
                    <th>What to Look For</th>
                </tr>
                <tr>
                    <td><strong>Memory Working Set</strong></td>
                    <td>App Service ‚Üí Metrics</td>
                    <td>Continuous upward trend without drops</td>
                </tr>
                <tr>
                    <td><strong>Private Bytes</strong></td>
                    <td>App Service ‚Üí Metrics</td>
                    <td>Memory allocated by the process</td>
                </tr>
                <tr>
                    <td><strong>Gen 2 GC Count</strong></td>
                    <td>Application Insights</td>
                    <td>Frequent Gen 2 collections indicate memory pressure</td>
                </tr>
                <tr>
                    <td><strong>CPU Time</strong></td>
                    <td>App Service ‚Üí Metrics</td>
                    <td>High CPU during GC indicates memory issues</td>
                </tr>
            </table>

            <h3>Steps to View Metrics</h3>
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Open Azure Portal</h4>
                    <p>Navigate to <a href="https://portal.azure.com" target="_blank">portal.azure.com</a></p>
                </div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>Find Your App Service</h4>
                    <p>Search for <code>memoryleak-training</code> in the search bar</p>
                </div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>Open Metrics</h4>
                    <p>In the left menu, click "Metrics" under Monitoring</p>
                </div>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>Add Memory Metric</h4>
                    <p>Select "Memory working set" from the metric dropdown</p>
                </div>
            </div>

            <div class="warning-box">
                <strong>Tip:</strong> Set the time range to "Last 30 minutes" and enable auto-refresh to see real-time changes while testing.
            </div>
        </div>

        <!-- Memory Dump Analysis -->
        <div class="card" id="memory-dump">
            <h2>üî¨ 7. Memory Dump Analysis</h2>
            
            <h3>Collecting a Memory Dump</h3>
            <pre><code><span class="highlight-green"># Using Azure CLI</span>
az webapp log download --resource-group rg-memoryleak-training \
    --name memoryleak-training --log-file dump.zip

<span class="highlight-green"># Or via Kudu Console</span>
<span class="highlight-green"># https://memoryleak-training.scm.azurewebsites.net/DebugConsole</span>
<span class="highlight-green"># Navigate to D:\home\LogFiles\Dumps</span></code></pre>

            <h3>Analysis with dotnet-dump</h3>
            <pre><code><span class="highlight-green"># Install dotnet-dump tool</span>
dotnet tool install -g dotnet-dump

<span class="highlight-green"># Analyze the dump</span>
dotnet-dump analyze dump.dmp

<span class="highlight-green"># Inside the analyzer, run these commands:</span>
> dumpheap -stat                    <span class="highlight-green"># Show heap statistics</span>
> dumpheap -type System.Byte[]      <span class="highlight-green"># Find byte arrays</span>
> gcroot &lt;address&gt;                  <span class="highlight-green"># Find what's holding the object</span></code></pre>

            <h3>What You'll Find</h3>
            <pre><code>              MT    Count    TotalSize Class Name
00007ff9...     450    472,500,000 System.Byte[]
00007ff9...       1          72 System.Collections.Concurrent.ConcurrentBag`1[[System.Byte[], ...]]

<span class="highlight-green">GC Root:</span>
    -> 00007ff9... System.Collections.Concurrent.ConcurrentBag`1[[System.Byte[]]]
       -> 00007ff9... System.Byte[] (472,500,000 bytes)
       
<span class="highlight-green">This shows the ConcurrentBag is holding all the byte arrays!</span></code></pre>
        </div>

        <!-- Deployment Guide -->
        <div class="card" id="deployment">
            <h2>üöÄ 8. Deployment Guide</h2>
            
            <h3>Option 1: Deploy via Azure Portal (Recommended)</h3>
            <p>Click the button below to open Azure Portal's custom deployment page:</p>
            <div style="margin: 20px 0;">
                <a href="https://portal.azure.com/#create/Microsoft.Template" target="_blank" style="display: inline-block; padding: 12px 24px; background: var(--primary); color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">
                    üöÄ Open Azure Custom Deployment
                </a>
            </div>
            <div class="info-box">
                <strong>Steps:</strong>
                <ol style="margin-top: 10px; padding-left: 20px;">
                    <li>Click the button above to open Azure Portal</li>
                    <li>Select "Build your own template in the editor"</li>
                    <li>Copy the content from <code>azuredeploy.json</code> file and paste it</li>
                    <li>Click "Save" then fill in the parameters</li>
                    <li>Click "Review + create" to deploy</li>
                </ol>
            </div>
            
            <h3>Option 2: Deploy to Azure Button</h3>
            <p>Click the button below to deploy directly:</p>
            <div style="margin: 20px 0;">
                <a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fbreadh1%2FAppServicePerfTraining%2Fmain%2Fazuredeploy.json" target="_blank">
                    <img src="https://aka.ms/deploytoazurebutton" alt="Deploy to Azure">
                </a>
            </div>

            <h3>Option 3: Azure CLI</h3>
            <pre><code><span class="highlight-green"># Login to Azure</span>
az login

<span class="highlight-green"># Create Resource Group</span>
az group create --name rg-memoryleak-training --location eastasia

<span class="highlight-green"># Deploy ARM Template</span>
az deployment group create \
    --resource-group rg-memoryleak-training \
    --template-file azuredeploy.json \
    --parameters webAppName=memoryleak-training sku=S1

<span class="highlight-green"># Publish the app</span>
dotnet publish -c Release -o ./publish

<span class="highlight-green"># Create zip and deploy</span>
cd publish && zip -r ../app.zip .
az webapp deploy --resource-group rg-memoryleak-training \
    --name memoryleak-training --src-path ../app.zip --type zip</code></pre>

            <h3>SKU Selection</h3>
            <div class="info-box">
                <strong>Any SKU works!</strong> For memory dump analysis training, the SKU choice doesn't matter. We only need the app to run and generate memory leaks. Choose based on your budget:
            </div>
            <table>
                <tr>
                    <th>SKU</th>
                    <th>Memory</th>
                    <th>Cost/Month (Est.)</th>
                </tr>
                <tr>
                    <td><strong>S1 (Standard)</strong></td>
                    <td>1.75 GB</td>
                    <td>~$73 USD ‚úÖ Recommended for training (supports dump collection)</td>
                </tr>
                <tr>
                    <td><strong>B2 (Basic)</strong></td>
                    <td>3.5 GB</td>
                    <td>~$110 USD</td>
                </tr>
                <tr>
                    <td><strong>B3 (Basic)</strong></td>
                    <td>7 GB</td>
                    <td>~$219 USD</td>
                </tr>
            </table>
            <div class="warning-box">
                <strong>Remember:</strong> Delete the resource group after training to avoid charges!
            </div>
        </div>

        <!-- Troubleshooting -->
        <div class="card" id="troubleshooting">
            <h2>üîß 9. Troubleshooting</h2>
            
            <h3>Common Issues</h3>
            
            <div class="step">
                <div class="step-number">!</div>
                <div class="step-content">
                    <h4>App crashes with OutOfMemoryException</h4>
                    <p><strong>Solution:</strong> This is expected when memory exceeds the limit. Click "Clear Memory" or restart the app. For S1 SKU, this happens around 1.5GB.</p>
                </div>
            </div>

            <div class="step">
                <div class="step-number">!</div>
                <div class="step-content">
                    <h4>Dashboard shows "Error" in logs</h4>
                    <p><strong>Solution:</strong> The API call may have failed due to memory pressure. Wait for GC to complete or clear memory.</p>
                </div>
            </div>

            <div class="step">
                <div class="step-number">!</div>
                <div class="step-content">
                    <h4>Azure metrics not updating</h4>
                    <p><strong>Solution:</strong> Azure metrics have 1-2 minute delay. Wait a moment and refresh. Ensure you've selected the correct time range.</p>
                </div>
            </div>

            <div class="step">
                <div class="step-number">!</div>
                <div class="step-content">
                    <h4>OverflowException when leaking large amounts</h4>
                    <p><strong>Solution:</strong> This was fixed in v1.0. If you see this, redeploy the latest version which uses <code>long</code> for size calculations.</p>
                </div>
            </div>
        </div>

        <!-- Cleanup -->
        <div class="card" id="cleanup">
            <h2>üßπ 10. Cleanup Resources</h2>
            
            <div class="warning-box">
                <strong>Important:</strong> Always clean up resources after training to avoid unnecessary Azure charges!
            </div>
            
            <h3>Delete All Resources</h3>
            <pre><code><span class="highlight-green"># Delete the entire resource group (removes all resources)</span>
az group delete --name rg-memoryleak-training --yes --no-wait

<span class="highlight-green"># Verify deletion</span>
az group list --query "[?name=='rg-memoryleak-training']"</code></pre>

            <div class="success-box">
                <strong>Cost Estimate:</strong> S1 App Service Plan costs approximately $0.10/hour. Remember to delete when not in use!
            </div>
        </div>

        <footer>
            <p>Memory Leak Training Lab v1.0 | Azure App Service Performance Training</p>
        </footer>
    </div>
</body>
</html>
